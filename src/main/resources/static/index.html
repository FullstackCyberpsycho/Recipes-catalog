<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—Ü–µ–ø—Ç–æ–≤</title>
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f4f6f9;margin:0;padding:0}
        .container{max-width:1100px;margin:30px auto;padding:20px}
        h1{text-align:center;color:#333;margin-bottom:20px}
        .controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
        .controls input,.controls select,.controls button{padding:8px 12px;font-size:14px;border-radius:8px;border:1px solid #ccc;outline:none}
        .controls button{background:#4CAF50;color:#fff;cursor:pointer;border:none;transition:0.2s}
        .controls button:hover{background:#43a047}
        #recipeList{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}
        .recipe-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);transition:0.2s;display:flex;flex-direction:column}
        .recipe-card:hover{transform:translateY(-5px)}
        .recipe-card img{width:100%;height:160px;object-fit:cover}
        .recipe-info{padding:12px;flex:1;display:flex;flex-direction:column;gap:4px}
        .recipe-info h3{margin:0;font-size:18px;color:#333;display:flex;justify-content:space-between;align-items:center}
        .recipe-info .category-badge{font-size:12px;background:#e0f7fa;color:#00796b;padding:2px 6px;border-radius:8px;margin-left:6px}
        .recipe-info p{margin:0;font-size:14px;color:#777;display:flex;justify-content:space-between;align-items:center}
        .recipe-actions{display:flex;justify-content:space-between;padding:10px;border-top:1px solid #eee}
        .recipe-actions button{flex:1;margin:0 4px;padding:6px 8px;font-size:13px;border-radius:6px;cursor:pointer;border:none;color:#fff;transition:0.2s}
        .details-btn{background:#6c63ff}.details-btn:hover{background:#5a54e6}
        .edit-btn{background:#2196F3}.edit-btn:hover{background:#1976D2}
        .delete-btn{background:#f44336}.delete-btn:hover{background:#d32f2f}
        .fav-btn{background:#FF9800}.fav-btn:hover{background:#F57C00}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:100}
        .modal-content{background:#fff;padding:20px 30px;border-radius:12px;width:500px;max-width:90%;position:relative;max-height:90vh;overflow-y:auto}
        .modal-content h3{margin-top:0}
        .modal-content input,.modal-content textarea,.modal-content select{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc}
        .modal-close{position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;color:#888}
        .modal-close:hover{color:#000}
        #imagePreview{width:100%;height:160px;object-fit:cover;margin-bottom:10px;border-radius:6px;display:none}
        .difficulty-badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600}
        .diff-easy{background:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9}
        .diff-medium{background:#fff3e0;color:#ef6c00;border:1px solid #ffe0b2}
        .diff-hard{background:#ffebee;color:#b71c1c;border:1px solid #ffcdd2}
        .diff-unknown{background:#eceff1;color:#607d8b;border:1px solid #cfd8dc}
        #detailsModal .modal-content p{margin:5px 0}
    </style>
</head>
<body>
<div class="container">
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h1>
    <div class="controls">
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">
        <select id="sort">
            <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
            <option value="name-asc">–ù–∞–∑–≤–∞–Ω–∏–µ –ê-–Ø</option>
            <option value="name-desc">–ù–∞–∑–≤–∞–Ω–∏–µ –Ø-–ê</option>
            <option value="time-asc">–í—Ä–µ–º—è ‚Üë</option>
            <option value="time-desc">–í—Ä–µ–º—è ‚Üì</option>
        </select>
        <button id="addRecipeBtn">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
        <button id="manageCategoriesBtn" style="background:#009688;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        <button id="showFavoritesBtn" style="background:#FF9800;">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
        <button id="showAllBtn">–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</button>
    </div>
    <div id="recipeList"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div class="modal" id="recipeModal">
    <div class="modal-content">
        <span class="modal-close" id="closeModal">&times;</span>
        <h3 id="modalTitle">–ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç</h3>
        <input type="text" id="recipeName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <textarea id="recipeIngredients" placeholder="–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã" rows="2"></textarea>
        <textarea id="recipeInstructions" placeholder="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" rows="2"></textarea>
        <textarea id="recipeDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="2"></textarea>
        <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
        <select id="recipeDifficulty">
            <option value="UNKNOWN">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
            <option value="EASY">–õ—ë–≥–∫–æ</option>
            <option value="MEDIUM">–°—Ä–µ–¥–Ω–µ</option>
            <option value="HARD">–°–ª–æ–∂–Ω–æ</option>
        </select>
        <input type="number" id="recipeTime" placeholder="–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è (–º–∏–Ω)">
        <input type="text" id="recipeImage" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <img id="imagePreview" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="recipeCategory"></select>
        <button id="saveRecipeBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</div>

<div class="modal" id="categoryModal">
    <div class="modal-content">
        <span class="modal-close" id="closeCategoryModal">&times;</span>
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
        <input type="text" id="newCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
        <button id="addCategoryBtn">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
        <ul id="categoryList"></ul>
    </div>
</div>

<div class="modal" id="detailsModal">
    <div class="modal-content">
        <span class="modal-close" id="closeDetailsModal">&times;</span>
        <h3 id="detailsTitle"></h3>
        <img id="detailsImage" style="width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:10px;">
        <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="detailsCategory"></span></p>
        <p><strong>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> <span id="detailsDifficulty"></span></p>
        <p><strong>–í—Ä–µ–º—è:</strong> <span id="detailsTime"></span> –º–∏–Ω</p>
        <p><strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong> <span id="detailsIngredients"></span></p>
        <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong> <span id="detailsInstructions"></span></p>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="detailsDescription"></span></p>
    </div>
</div>

<div class="modal" id="editCategoryModal">
    <div class="modal-content">
        <span class="modal-close" id="closeEditCategoryModal">&times;</span>
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
        <input type="text" id="editCategoryName" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
        <button id="saveEditCategoryBtn" style="background:#4CAF50;color:#fff;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="cancelEditCategoryBtn" style="background:#ccc;color:#000;">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<div class="modal" id="confirmDeleteModal">
    <div class="modal-content">
        <span class="modal-close" id="closeConfirmDeleteModal">&times;</span>
        <h3>–£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç?</h3>
        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ—Ü–µ–ø—Ç?</p>
        <button id="confirmDeleteBtn" style="background:#f44336;color:#fff;">–£–¥–∞–ª–∏—Ç—å</button>
        <button id="cancelDeleteBtn" style="background:#ccc;color:#000;">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<div class="modal" id="confirmDeleteCategoryModal">
    <div class="modal-content">
        <span class="modal-close" id="closeConfirmDeleteCategoryModal">&times;</span>
        <h3>–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?</h3>
        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?</p>
        <button id="confirmDeleteCategoryBtn" style="background:#f44336;color:#fff;">–£–¥–∞–ª–∏—Ç—å</button>
        <button id="cancelDeleteCategoryBtn" style="background:#ccc;color:#000;">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>








<script>
    const apiUrl = "http://localhost:8080/api/recipes",
          catUrl = "http://localhost:8080/api/categories",
          favUrl = "http://localhost:8080/api/recipes/favorites";

    let recipes = [], favorites = [], categories = [], editId = null, showingFavorites = false;

    // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
    const recipeList = document.getElementById("recipeList"),
          searchInput = document.getElementById("search"),
          sortSelect = document.getElementById("sort"),
          addRecipeBtn = document.getElementById("addRecipeBtn"),
          showFavoritesBtn = document.getElementById("showFavoritesBtn"),
          showAllBtn = document.getElementById("showAllBtn"),
          manageCategoriesBtn = document.getElementById("manageCategoriesBtn"),
          modal = document.getElementById("recipeModal"),
          closeModal = document.getElementById("closeModal"),
          modalTitle = document.getElementById("modalTitle"),
          recipeName = document.getElementById("recipeName"),
          recipeIngredients = document.getElementById("recipeIngredients"),
          recipeInstructions = document.getElementById("recipeInstructions"),
          recipeDescription = document.getElementById("recipeDescription"),
          recipeDifficulty = document.getElementById("recipeDifficulty"),
          recipeTime = document.getElementById("recipeTime"),
          recipeImage = document.getElementById("recipeImage"),
          saveRecipeBtn = document.getElementById("saveRecipeBtn"),
          imagePreview = document.getElementById("imagePreview"),
          categorySelect = document.getElementById("recipeCategory"),
          categoryModal = document.getElementById("categoryModal"),
          closeCategoryModal = document.getElementById("closeCategoryModal"),
          newCategoryName = document.getElementById("newCategoryName"),
          addCategoryBtn = document.getElementById("addCategoryBtn"),
          categoryList = document.getElementById("categoryList"),
          editCategoryModal = document.getElementById("editCategoryModal"),
          editCategoryName = document.getElementById("editCategoryName"),
          saveEditCategoryBtn = document.getElementById("saveEditCategoryBtn"),
          cancelEditCategoryBtn = document.getElementById("cancelEditCategoryBtn"),
          closeEditCategoryModal = document.getElementById("closeEditCategoryModal"),
          confirmDeleteCategoryModal = document.getElementById("confirmDeleteCategoryModal"),
          confirmDeleteCategoryBtn = document.getElementById("confirmDeleteCategoryBtn"),
          cancelDeleteCategoryBtn = document.getElementById("cancelDeleteCategoryBtn"),
          closeConfirmDeleteCategoryModal = document.getElementById("closeConfirmDeleteCategoryModal");

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
    let editingCategoryId = null, deletingCategoryId = null, deletingRecipeId = null;

    // =============================
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    // =============================
    async function loadCategories() {
        try {
            const res = await fetch(catUrl);
            categories = await res.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º select –≤ —Ñ–æ—Ä–º–µ —Ä–µ—Ü–µ–ø—Ç–∞
            categorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            categories.forEach(c => categorySelect.innerHTML += `<option value="${c.id}">${c.name}</option>`);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            categoryList.innerHTML = '';
            categories.forEach(c => {
                const li = document.createElement("li");
                li.textContent = c.name + " ";

                const editBtn = document.createElement("button");
                editBtn.textContent = "‚úé";
                editBtn.onclick = () => showEditCategory(c.id, c.name);

                const delBtn = document.createElement("button");
                delBtn.textContent = "üóë";
                delBtn.onclick = () => showDeleteCategoryModal(c.id);

                li.appendChild(editBtn);
                li.appendChild(delBtn);
                categoryList.appendChild(li);
            });
        } catch (e) { console.error(e); }
    }

    // =============================
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    // =============================
    addCategoryBtn.onclick = async () => {
        const name = newCategoryName.value.trim();
        if (!name) return;
        await fetch(catUrl, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ name }) });
        newCategoryName.value = "";
        await loadCategories();
        await loadData(false, true);
    };

    // =============================
    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    // =============================
    function showEditCategory(id, name) {
        editingCategoryId = id;
        editCategoryName.value = name;
        editCategoryModal.style.display = "flex";
    }
    cancelEditCategoryBtn.onclick = closeEditCategoryModal.onclick = () => editCategoryModal.style.display = "none";
    saveEditCategoryBtn.onclick = async () => {
    const newName = editCategoryName.value.trim();
    if (!newName) return;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    await fetch(`${catUrl}/${editingCategoryId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: newName })
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    categories = categories.map(c => c.id === editingCategoryId ? { ...c, name: newName } : c);

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã: –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –º–µ–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
    recipes = recipes.map(r => r.category?.id === editingCategoryId ? { ...r, category: { ...r.category, name: newName } } : r);
    favorites = favorites.map(r => r.category?.id === editingCategoryId ? { ...r, category: { ...r.category, name: newName } } : r);

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
    renderRecipes();
    await loadCategories(); // –æ–±–Ω–æ–≤–ª—è–µ–º select –∏ —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

    editCategoryModal.style.display = "none";
    editingCategoryId = null;
};

///////////////


    // =============================
    // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    // =============================
    function showDeleteCategoryModal(id) {
        deletingCategoryId = id;
        confirmDeleteCategoryModal.style.display = "flex";
    }
    cancelDeleteCategoryBtn.onclick = closeConfirmDeleteCategoryModal.onclick = () => confirmDeleteCategoryModal.style.display = "none";
    confirmDeleteCategoryBtn.onclick = async () => {
    await fetch(`${catUrl}/${deletingCategoryId}`, { method: "DELETE" });

    // –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è: –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    await loadCategories();

    // –£–±–∏—Ä–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É –≤—Å–µ—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    recipes = recipes.map(r => {
        if (r.category?.id === deletingCategoryId) r.category = null;
        return r;
    });
    favorites = favorites.map(r => {
        if (r.category?.id === deletingCategoryId) r.category = null;
        return r;
    });

    renderRecipes();

    confirmDeleteCategoryModal.style.display = "none";
    deletingCategoryId = null;
};

///////////

    // =============================
    // –†–µ—Ü–µ–ø—Ç—ã
    // =============================
    function difficultyLabel(d) {
        switch (d) { case "EASY": return "–õ—ë–≥–∫–æ"; case "MEDIUM": return "–°—Ä–µ–¥–Ω–µ"; case "HARD": return "–°–ª–æ–∂–Ω–æ"; default: return "–ù–µ —É–∫–∞–∑–∞–Ω–æ"; }
    }
    function difficultyClass(d) {
        switch (d) { case "EASY": return "diff-easy"; case "MEDIUM": return "diff-medium"; case "HARD": return "diff-hard"; default: return "diff-unknown"; }
    }

    async function loadFavorites() {
        const res = await fetch(favUrl);
        favorites = res.ok ? await res.json() : [];
    }

    async function loadData(favOnly = false, sorted = false) {
        showingFavorites = favOnly;
        const res = await fetch(favOnly ? favUrl : apiUrl);
        let data = await res.json();

        if (sorted) {
            const val = sortSelect.value;
            if (val === "name-asc") data.sort((a, b) => a.name.localeCompare(b.name));
            else if (val === "name-desc") data.sort((a, b) => b.name.localeCompare(a.name));
            else if (val === "time-asc") data.sort((a, b) => (a.cookingTime || 0) - (b.cookingTime || 0));
            else if (val === "time-desc") data.sort((a, b) => (b.cookingTime || 0) - (a.cookingTime || 0));
        }

        if (favOnly) favorites = data; else recipes = data;
        renderRecipes();
    }

    function renderRecipes() {
        const list = showingFavorites ? favorites : recipes;
        const search = (searchInput.value || "").toLowerCase();
        const filtered = list.filter(r => (r.name || "").toLowerCase().includes(search));
        recipeList.innerHTML = "";
        if (!filtered.length) { recipeList.innerHTML = "<p>–†–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>"; return; }

        filtered.forEach(r => {
            const isFav = favorites.some(f => f.id === r.id);
            const card = document.createElement("div");
            card.className = "recipe-card";
            card.innerHTML = `
                <img src="${r.imageUrl || 'https://via.placeholder.com/300x150'}">
                <div class="recipe-info">
                    <h3>${r.name} <span class="category-badge">${r.category?.name || "‚Äî"}</span></h3>
                    <p><span>‚è± ${r.cookingTime || 0} –º–∏–Ω</span><span class="difficulty-badge ${difficultyClass(r.difficulty)}">${difficultyLabel(r.difficulty)}</span></p>
                </div>
                <div class="recipe-actions">
                    <button class="details-btn" onclick="showDetails(${r.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                    <button class="edit-btn" onclick="editRecipe(${r.id})">‚úé</button>
                    <button class="delete-btn" onclick="showDeleteRecipeModal(${r.id})">üóë</button>
                    <button class="fav-btn" onclick="toggleFavorite(${r.id})">${isFav ? "‚≠ê" : "‚òÜ"}</button>
                </div>`;
            recipeList.appendChild(card);
        });
    }

    // =============================
    // –î–µ—Ç–∞–ª–∏ —Ä–µ—Ü–µ–ø—Ç–∞
    // =============================
    const detailsModal = document.getElementById("detailsModal"),
          closeDetailsModal = document.getElementById("closeDetailsModal"),
          detailsTitle = document.getElementById("detailsTitle"),
          detailsImage = document.getElementById("detailsImage"),
          detailsCategory = document.getElementById("detailsCategory"),
          detailsDifficulty = document.getElementById("detailsDifficulty"),
          detailsTime = document.getElementById("detailsTime"),
          detailsIngredients = document.getElementById("detailsIngredients"),
          detailsInstructions = document.getElementById("detailsInstructions"),
          detailsDescription = document.getElementById("detailsDescription");

    function showDetails(id) {
        const r = recipes.find(x => x.id === id) || favorites.find(x => x.id === id);
        if (!r) return;
        detailsTitle.textContent = r.name;
        detailsImage.src = r.imageUrl || "https://via.placeholder.com/300x150";
        detailsCategory.textContent = r.category?.name || "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
        detailsDifficulty.textContent = difficultyLabel(r.difficulty);
        detailsTime.textContent = r.cookingTime || 0;
        detailsIngredients.textContent = r.ingredients || "‚Äî";
        detailsInstructions.textContent = r.instructions || "‚Äî";
        detailsDescription.textContent = r.description || "‚Äî";
        detailsModal.style.display = "flex";
    }
    closeDetailsModal.onclick = () => detailsModal.style.display = "none";

    // =============================
    // –ù–æ–≤—ã–π/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
    // =============================
    addRecipeBtn.onclick = () => {
        modalTitle.textContent = "–ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç";
        recipeName.value = recipeIngredients.value = recipeInstructions.value = recipeDescription.value = recipeTime.value = recipeImage.value = "";
        recipeDifficulty.value = "UNKNOWN"; categorySelect.value = ""; imagePreview.style.display = "none"; editId = null;
        modal.style.display = "flex";
    };
    closeModal.onclick = () => modal.style.display = "none";

    recipeImage.oninput = () => {
        if (recipeImage.value) { imagePreview.src = recipeImage.value; imagePreview.style.display = "block"; }
        else imagePreview.style.display = "none";
    };

    saveRecipeBtn.onclick = async () => {
        const time = parseInt(recipeTime.value);
        const data = {
            name: recipeName.value,
            ingredients: recipeIngredients.value,
            instructions: recipeInstructions.value,
            description: recipeDescription.value,
            cookingTime: isNaN(time) ? 0 : time,
            imageUrl: recipeImage.value,
            difficulty: (recipeDifficulty.value || "UNKNOWN").toUpperCase(),
            category: categorySelect.value ? { id: categorySelect.value } : null
        };
        if (editId) await fetch(`${apiUrl}/${editId}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) });
        else await fetch(apiUrl, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) });

        modal.style.display = "none";
        await loadData(showingFavorites, true);
        await loadFavorites();
    };

    function editRecipe(id) {
        const r = recipes.find(x => x.id === id) || favorites.find(x => x.id === id);
        if (!r) return;
        modalTitle.textContent = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç";
        recipeName.value = r.name || "";
        recipeIngredients.value = r.ingredients || "";
        recipeInstructions.value = r.instructions || "";
        recipeDescription.value = r.description || "";
        recipeTime.value = r.cookingTime || "";
        recipeImage.value = r.imageUrl || "";
        recipeDifficulty.value = r.difficulty || "UNKNOWN";
        categorySelect.value = r.category?.id || "";
        if (r.imageUrl) { imagePreview.src = r.imageUrl; imagePreview.style.display = "block"; }
        else imagePreview.style.display = "none";
        editId = id; modal.style.display = "flex";
    }

    // =============================
    // –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞
    // =============================
    const confirmDeleteModal = document.getElementById("confirmDeleteModal"),
          confirmDeleteBtn = document.getElementById("confirmDeleteBtn"),
          cancelDeleteBtn = document.getElementById("cancelDeleteBtn"),
          closeConfirmDeleteModal = document.getElementById("closeConfirmDeleteModal");

    function showDeleteRecipeModal(id) {
    deletingRecipeId = id;
    confirmDeleteModal.style.display = "flex";
}

confirmDeleteBtn.onclick = async () => {
    if (!deletingRecipeId) return;

    // –£–¥–∞–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    await fetch(`${apiUrl}/${deletingRecipeId}`, { method: "DELETE" });

    // –£–¥–∞–ª—è–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤, —á—Ç–æ–±—ã —É–¥–∞–ª–µ–Ω–∏–µ –±—ã–ª–æ –≤–µ–∑–¥–µ
    recipes = recipes.filter(r => r.id !== deletingRecipeId);
    favorites = favorites.filter(f => f.id !== deletingRecipeId);

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
    renderRecipes();

    // –°–±—Ä–æ—Å–∏–º id —É–¥–∞–ª–µ–Ω–∏—è –∏ –∑–∞–∫—Ä–æ–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    deletingRecipeId = null;
    confirmDeleteModal.style.display = "none";
};

    // =============================
    // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
    // =============================
    async function toggleFavorite(id) {
        const isFav = favorites.some(f => f.id === id);
        await fetch(`${favUrl}/${id}`, { method: isFav ? "DELETE" : "POST" });
        await loadFavorites(); renderRecipes();
    }

    // =============================
    // –°–æ–±—ã—Ç–∏—è
    // =============================
    searchInput.oninput = renderRecipes;
    sortSelect.onchange = () => loadData(showingFavorites, true);
    showFavoritesBtn.onclick = async () => { await loadFavorites(); showingFavorites = true; renderRecipes(); }
    showAllBtn.onclick = () => { showingFavorites = false; loadData(false, true); }
    manageCategoriesBtn.onclick = () => categoryModal.style.display = "flex";
    closeCategoryModal.onclick = () => categoryModal.style.display = "none";

    // =============================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // =============================
    (async function init() {
        await loadData(false, true);
        await loadCategories();
        await loadFavorites();
    })();
</script>

</body>
</html>
