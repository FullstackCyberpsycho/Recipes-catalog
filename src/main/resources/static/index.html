<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—Ü–µ–ø—Ç–æ–≤</title>
    <style>
        body {
          font-family: 'Segoe UI', Tahoma, sans-serif;
          background: #f4f6f9;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 1100px;
          margin: 30px auto;
          padding: 20px;
        }
        h1 {
          text-align: center;
          color: #333;
          margin-bottom: 20px;
        }
        .controls {
          display: flex;
          gap: 10px;
          margin-bottom: 20px;
          flex-wrap: wrap;
          justify-content: center;
        }
        .controls input, .controls select, .controls button {
          padding: 8px 12px;
          font-size: 14px;
          border-radius: 8px;
          border: 1px solid #ccc;
          outline: none;
        }
        .controls button {
          background: #4CAF50;
          color: #fff;
          cursor: pointer;
          border: none;
          transition: background 0.2s;
        }
        .controls button:hover { background: #43a047; }
        #recipeList {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 20px;
        }
        .recipe-card {
          background: #fff;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0,0,0,0.08);
          transition: transform 0.2s;
          display: flex;
          flex-direction: column;
        }
        .recipe-card:hover { transform: translateY(-5px); }
        .recipe-card img {
          width: 100%;
          height: 160px;
          object-fit: cover;
        }
        .recipe-info { padding: 12px; flex: 1; }
        .recipe-info h3 { margin: 0; font-size: 18px; color: #333; }
        .recipe-info p { margin: 5px 0 0; font-size: 14px; color: #777; }
        .recipe-actions {
          display: flex;
          justify-content: space-between;
          padding: 10px;
          border-top: 1px solid #eee;
        }
        .recipe-actions button {
          flex: 1;
          margin: 0 4px;
          padding: 6px 8px;
          font-size: 13px;
          border-radius: 6px;
          cursor: pointer;
          border: none;
          color: #fff;
          transition: 0.2s;
        }
        .details-btn { background: #6c63ff; }
        .details-btn:hover { background: #5a54e6; }
        .edit-btn { background: #2196F3; }
        .edit-btn:hover { background: #1976D2; }
        .delete-btn { background: #f44336; }
        .delete-btn:hover { background: #d32f2f; }
        .fav-btn { background: #FF9800; }
        .fav-btn:hover { background: #F57C00; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
          display: none;
          position: fixed;
          top:0; left:0;
          width:100%; height:100%;
          background: rgba(0,0,0,0.5);
          justify-content: center;
          align-items: center;
          z-index: 100;
        }
        .modal-content {
          background: #fff;
          padding: 20px 30px;
          border-radius: 12px;
          width: 500px;
          max-width: 90%;
          position: relative;
          max-height: 90vh;
          overflow-y: auto;
        }
        .modal-content h3 { margin-top: 0; }
        .modal-content input, .modal-content textarea {
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 6px;
          border: 1px solid #ccc;
        }
        .modal-close {
          position: absolute;
          top: 10px;
          right: 15px;
          font-size: 20px;
          cursor: pointer;
          color: #888;
        }
        .modal-close:hover { color: #000; }
        #imagePreview {
          width: 100%;
          height: 160px;
          object-fit: cover;
          margin-bottom: 10px;
          border-radius: 6px;
          display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h1>
    <div class="controls">
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">
        <select id="sort">
            <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
            <option value="name-asc">–ù–∞–∑–≤–∞–Ω–∏–µ –ê-–Ø</option>
            <option value="name-desc">–ù–∞–∑–≤–∞–Ω–∏–µ –Ø-–ê</option>
            <option value="time-asc">–í—Ä–µ–º—è ‚Üë</option>
            <option value="time-desc">–í—Ä–µ–º—è ‚Üì</option>
        </select>
        <button id="addRecipeBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button id="showFavoritesBtn" style="background:#FF9800;">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
        <button id="showAllBtn">–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</button>
    </div>
    <div id="recipeList"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal" id="recipeModal">
    <div class="modal-content">
        <span class="modal-close" id="closeModal">&times;</span>
        <h3 id="modalTitle">–ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç</h3>
        <input type="text" id="recipeName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
        <textarea id="recipeIngredients" placeholder="–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã" rows="2" required></textarea>
        <textarea id="recipeInstructions" placeholder="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" rows="2" required></textarea>
        <textarea id="recipeDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="2"></textarea>
        <input type="number" id="recipeTime" placeholder="–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è (–º–∏–Ω)" required>
        <input type="text" id="recipeImage" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <img id="imagePreview" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <button id="saveRecipeBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
<div class="modal" id="detailsModal">
    <div class="modal-content">
        <span class="modal-close" id="closeDetails">&times;</span>
        <h3 id="detailsTitle"></h3>
        <img id="detailsImage" style="width:100%; height:200px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
        <p><strong>–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> <span id="detailsTime"></span> –º–∏–Ω</p>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="detailsDescription"></span></p>
        <p><strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong></p>
        <p id="detailsIngredients"></p>
        <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong></p>
        <p id="detailsInstructions"></p>
    </div>
</div>

<script>
    const apiUrl = "http://localhost:8080/api/recipes";
    const favUrl = "http://localhost:8080/api/recipes/favorites";

    let recipes = [];
    let favorites = [];
    let editId = null;
    let showingFavorites = false;

    const recipeList = document.getElementById("recipeList");
    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const addRecipeBtn = document.getElementById("addRecipeBtn");
    const showFavoritesBtn = document.getElementById("showFavoritesBtn");
    const showAllBtn = document.getElementById("showAllBtn");

    const modal = document.getElementById("recipeModal");
    const closeModal = document.getElementById("closeModal");
    const modalTitle = document.getElementById("modalTitle");
    const recipeName = document.getElementById("recipeName");
    const recipeIngredients = document.getElementById("recipeIngredients");
    const recipeInstructions = document.getElementById("recipeInstructions");
    const recipeDescription = document.getElementById("recipeDescription");
    const recipeTime = document.getElementById("recipeTime");
    const recipeImage = document.getElementById("recipeImage");
    const saveRecipeBtn = document.getElementById("saveRecipeBtn");
    const imagePreview = document.getElementById("imagePreview");

    const detailsModal = document.getElementById("detailsModal");
    const closeDetails = document.getElementById("closeDetails");
    const detailsTitle = document.getElementById("detailsTitle");
    const detailsImage = document.getElementById("detailsImage");
    const detailsTime = document.getElementById("detailsTime");
    const detailsDescription = document.getElementById("detailsDescription");
    const detailsIngredients = document.getElementById("detailsIngredients");
    const detailsInstructions = document.getElementById("detailsInstructions");

    recipeImage.addEventListener("input", () => {
      if(recipeImage.value){
        imagePreview.src = recipeImage.value;
        imagePreview.style.display = "block";
      } else imagePreview.style.display = "none";
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤
    async function loadRecipes(sorted=false){
      showingFavorites = false;
      let url = apiUrl;
      if(sorted){
        const sortVal = sortSelect.value;
        if(sortVal === "name-asc") url += "/sortedNameAsc";
        if(sortVal === "name-desc") url += "/sortedNameDesc";
        if(sortVal === "time-asc") url += "/sortedCookingTimeAsc";
        if(sortVal === "time-desc") url += "/sortedCookingTimeDesc";
      }
      const res = await fetch(url);
      recipes = await res.json();
      renderRecipes();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    async function loadFavorites(sorted=false){
      showingFavorites = true;
      let url = favUrl;
      if(sorted){
        const sortVal = sortSelect.value;
        if(sortVal === "name-asc") url += "/sortedNameAsc";
        if(sortVal === "name-desc") url += "/sortedNameDesc";
        if(sortVal === "time-asc") url += "/sortedCookingTimeAsc";
        if(sortVal === "time-desc") url += "/sortedCookingTimeDesc";
      }
      const res = await fetch(url);
      favorites = await res.json();
      renderRecipes(favorites);
    }

    // –†–µ–Ω–¥–µ—Ä
    function renderRecipes(data){
      const list = data || recipes;
      const search = searchInput.value.toLowerCase();
      recipeList.innerHTML = "";
      const filtered = list.filter(r => r.name.toLowerCase().includes(search));
      if(filtered.length === 0){
        recipeList.innerHTML = "<p>–†–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>";
        return;
      }
      filtered.forEach(r => {
        const isFav = favorites.some(f => f.id === r.id);
        const card = document.createElement("div");
        card.className = "recipe-card";
        card.innerHTML = `
          <img src="${r.imageUrl || 'https://via.placeholder.com/300x150'}" alt="${r.name}">
          <div class="recipe-info">
            <h3>${r.name}</h3>
            <p>‚è± ${r.cookingTime || 0} –º–∏–Ω</p>
          </div>
          <div class="recipe-actions">
            <button class="details-btn" onclick="showDetails(${r.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="edit-btn" onclick="editRecipe(${r.id})">‚úé</button>
            <button class="delete-btn" onclick="deleteRecipe(${r.id})">üóë</button>
            <button class="fav-btn" onclick="toggleFavorite(${r.id})">${isFav ? '‚≠ê' : '‚òÜ'}</button>
          </div>
        `;
        recipeList.appendChild(card);
      });
    }

    // –ü–æ–¥—Ä–æ–±–Ω–µ–µ
    function showDetails(id){
      const list = showingFavorites ? favorites : recipes;
      const r = list.find(x => x.id === id);
      detailsTitle.textContent = r.name;
      detailsImage.src = r.imageUrl || 'https://via.placeholder.com/300x150';
      detailsTime.textContent = r.cookingTime || 0;
      detailsDescription.textContent = r.description || '‚Äî';
      detailsIngredients.textContent = r.ingredients;
      detailsInstructions.textContent = r.instructions;
      detailsModal.style.display = "flex";
    }
    closeDetails.addEventListener("click", ()=> detailsModal.style.display="none");

    // CRUD
    addRecipeBtn.addEventListener("click", ()=> {
      modalTitle.textContent = "–ù–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç";
      recipeName.value = recipeIngredients.value = recipeInstructions.value = recipeDescription.value = recipeTime.value = recipeImage.value = "";
      imagePreview.style.display = "none";
      editId = null;
      modal.style.display = "flex";
    });
    closeModal.addEventListener("click", ()=> modal.style.display = "none");

    saveRecipeBtn.addEventListener("click", async ()=> {
      const data = {
        name: recipeName.value,
        ingredients: recipeIngredients.value,
        instructions: recipeInstructions.value,
        description: recipeDescription.value,
        cookingTime: parseInt(recipeTime.value),
        imageUrl: recipeImage.value
      };
      if(editId){
        await fetch(`${apiUrl}/${editId}`, {method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data)});
      } else {
        await fetch(apiUrl, {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data)});
      }
      modal.style.display="none";
      await loadRecipes();
      await loadFavorites();
    });

    async function deleteRecipe(id){
      if(confirm("–£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç?")){
        await fetch(`${apiUrl}/${id}`, { method:"DELETE" });
        await loadRecipes();
        await loadFavorites();
      }
    }

    function editRecipe(id){
      const list = showingFavorites ? favorites : recipes;
      const r = list.find(x => x.id === id);
      modalTitle.textContent="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç";
      recipeName.value = r.name;
      recipeIngredients.value = r.ingredients;
      recipeInstructions.value = r.instructions;
      recipeDescription.value = r.description || '';
      recipeTime.value = r.cookingTime;
      recipeImage.value = r.imageUrl || '';
      if(r.imageUrl){ imagePreview.src = r.imageUrl; imagePreview.style.display = "block"; }
      else imagePreview.style.display = "none";
      editId = id;
      modal.style.display = "flex";
    }

    // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
    async function toggleFavorite(id){
      const isFav = favorites.some(f => f.id === id);
      const method = isFav ? "DELETE" : "POST";
      await fetch(`${favUrl}/${id}`, { method });
      await loadFavorites();
      renderRecipes(showingFavorites ? favorites : recipes);
    }

    // –°–æ–±—ã—Ç–∏—è
    searchInput.addEventListener("input", ()=> renderRecipes(showingFavorites ? favorites : recipes));
    sortSelect.addEventListener("change", ()=> {
      if(showingFavorites){ loadFavorites(true); }
      else { loadRecipes(true); }
    });

    showFavoritesBtn.addEventListener("click", async ()=> { await loadFavorites(); });
    showAllBtn.addEventListener("click", async ()=> { await loadRecipes(); });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    async function init(){
      await loadRecipes();
      await loadFavorites();
    }
    init();
</script>
</body>
</html>
