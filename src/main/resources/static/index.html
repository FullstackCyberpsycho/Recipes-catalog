<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Каталог рецептов</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        .container { max-width: 1000px; margin: 30px auto; background: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 20px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .controls input, .controls select { padding: 10px; font-size: 14px; border-radius: 6px; border: 1px solid #ccc; flex: 1; }
        .controls button { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .controls button:hover { background: #45a049; }
        #recipeList { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .recipe-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
        .recipe-card img { width: 100%; height: 150px; object-fit: cover; }
        .recipe-content { padding: 10px 15px; flex: 1; }
        .recipe-content h3 { margin: 0 0 10px; font-size: 18px; }
        .recipe-content p { margin: 0 0 6px; font-size: 14px; color: #555; }
        .recipe-actions { display: flex; justify-content: space-between; padding: 10px 15px; border-top: 1px solid #eee; }
        .recipe-actions button { flex: 1; margin: 0 5px; padding: 8px 5px; font-size: 14px; border-radius: 6px; cursor: pointer; border: none; color: #fff; transition: 0.2s; }
        .edit-btn { background: #2196F3; } .edit-btn:hover { background: #1976D2; }
        .delete-btn { background: #f44336; } .delete-btn:hover { background: #d32f2f; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: #fff; padding: 20px 30px; border-radius: 12px; width: 400px; max-width: 90%; position: relative; }
        .modal-content h3 { margin-top: 0; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; }
        .modal-content button { padding: 10px; background: #4CAF50; color: #fff; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-size: 14px; }
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; color: #888; }
        #imagePreview { width: 100%; height: 150px; object-fit: cover; margin-bottom: 10px; border-radius: 6px; display: none; }
    </style>
</head>
<body>
<div class="container">
    <h1>Каталог рецептов</h1>
    <div class="controls">
        <input type="text" id="search" placeholder="Поиск по названию">
        <select id="sort">
            <option value="">Сортировка</option>
            <option value="name-asc">Название А-Я</option>
            <option value="name-desc">Название Я-А</option>
            <option value="time-asc">Время ↑</option>
            <option value="time-desc">Время ↓</option>
        </select>
        <button id="addRecipeBtn">Добавить рецепт</button>
    </div>
    <div id="recipeList"></div>
</div>

<div class="modal" id="recipeModal">
    <div class="modal-content">
        <span class="modal-close" id="closeModal">&times;</span>
        <h3 id="modalTitle">Новый рецепт</h3>
        <input type="text" id="recipeName" placeholder="Название" required>
        <textarea id="recipeIngredients" placeholder="Ингредиенты" rows="2" required></textarea>
        <textarea id="recipeInstructions" placeholder="Инструкции" rows="2" required></textarea>
        <textarea id="recipeDescription" placeholder="Описание" rows="2"></textarea>
        <input type="number" id="recipeTime" placeholder="Время приготовления (мин)" required>
        <input type="text" id="recipeImage" placeholder="URL изображения">
        <img id="imagePreview" alt="Превью изображения">
        <button id="saveRecipeBtn">Сохранить</button>
    </div>
</div>

<script>
    const apiUrl = "http://localhost:8080/api/recipes";
    let recipes = [];
    let editId = null;

    const recipeList = document.getElementById("recipeList");
    const searchInput = document.getElementById("search");
    const sortSelect = document.getElementById("sort");
    const addRecipeBtn = document.getElementById("addRecipeBtn");
    const modal = document.getElementById("recipeModal");
    const closeModal = document.getElementById("closeModal");
    const modalTitle = document.getElementById("modalTitle");
    const recipeName = document.getElementById("recipeName");
    const recipeIngredients = document.getElementById("recipeIngredients");
    const recipeInstructions = document.getElementById("recipeInstructions");
    const recipeDescription = document.getElementById("recipeDescription");
    const recipeTime = document.getElementById("recipeTime");
    const recipeImage = document.getElementById("recipeImage");
    const saveRecipeBtn = document.getElementById("saveRecipeBtn");
    const imagePreview = document.getElementById("imagePreview");

    recipeImage.addEventListener("input", () => {
      if(recipeImage.value){
        imagePreview.src = recipeImage.value;
        imagePreview.style.display = "block";
      } else imagePreview.style.display = "none";
    });

    async function loadRecipes(sorted=false){
      let url = apiUrl;
      if(sorted){
        const sortVal = sortSelect.value;
        if(sortVal === "name-asc") url += "/sorted-name-ASC";
        if(sortVal === "name-desc") url += "/sorted-name-DESC";
        if(sortVal === "time-asc") url += "/sorted-cooking-time-ASC";
        if(sortVal === "time-desc") url += "/sorted-cooking-time-DESC";
      }
      try{
        const res = await fetch(url);
        recipes = await res.json();
        renderRecipes();
      }catch(e){ console.error("Ошибка загрузки рецептов:", e);}
    }

    function renderRecipes(){
      const search = searchInput.value.toLowerCase();
      recipeList.innerHTML = "";
      const filtered = recipes.filter(r => r.name.toLowerCase().includes(search));
      if(filtered.length === 0){
        recipeList.innerHTML = "<p>Рецептов не найдено</p>";
        return;
      }
      filtered.forEach(r => {
        const card = document.createElement("div");
        card.className = "recipe-card";
        card.innerHTML = `
          <img src="${r.imageUrl || 'https://via.placeholder.com/300x150'}" alt="${r.name}">
          <div class="recipe-content">
            <h3>${r.name}</h3>
            <p>Время: ${r.cookingTime || 0} мин</p>
            <p><strong>Ингредиенты:</strong> ${r.ingredients}</p>
            <p><strong>Инструкции:</strong> ${r.instructions}</p>
            <p>${r.description || ''}</p>
          </div>
          <div class="recipe-actions">
            <button class="edit-btn" onclick="editRecipe(${r.id})">Редактировать</button>
            <button class="delete-btn" onclick="deleteRecipe(${r.id})">Удалить</button>
          </div>
        `;
        recipeList.appendChild(card);
      });
    }

    addRecipeBtn.addEventListener("click", ()=>{
      modalTitle.textContent = "Новый рецепт";
      recipeName.value = recipeIngredients.value = recipeInstructions.value = recipeDescription.value = recipeTime.value = recipeImage.value = "";
      imagePreview.style.display = "none";
      editId = null;
      modal.style.display = "flex";
    });

    closeModal.addEventListener("click", ()=> modal.style.display = "none");

    saveRecipeBtn.addEventListener("click", async ()=>{
      const data = {
        name: recipeName.value,
        ingredients: recipeIngredients.value,
        instructions: recipeInstructions.value,
        description: recipeDescription.value,
        cookingTime: parseInt(recipeTime.value),
        imageUrl: recipeImage.value
      };
      try{
        if(editId){
          await fetch(`${apiUrl}/${editId}`, {
            method:"PUT",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(data)
          });
        } else {
          await fetch(apiUrl, {
            method:"POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(data)
          });
        }
        modal.style.display="none";
        loadRecipes();
      }catch(e){ console.error("Ошибка сохранения:", e);}
    });

    async function deleteRecipe(id){
      if(confirm("Удалить рецепт?")){
        try{
          await fetch(`${apiUrl}/${id}`, { method:"DELETE" });
          loadRecipes();
        }catch(e){ console.error("Ошибка удаления:", e);}
      }
    }

    function editRecipe(id){
      const r = recipes.find(r => r.id === id);
      modalTitle.textContent="Редактировать рецепт";
      recipeName.value = r.name;
      recipeIngredients.value = r.ingredients;
      recipeInstructions.value = r.instructions;
      recipeDescription.value = r.description || '';
      recipeTime.value = r.cookingTime;
      recipeImage.value = r.imageUrl || '';
      if(r.imageUrl){
        imagePreview.src = r.imageUrl;
        imagePreview.style.display = "block";
      } else imagePreview.style.display = "none";
      editId = id;
      modal.style.display = "flex";
    }

    searchInput.addEventListener("input", renderRecipes);
    sortSelect.addEventListener("change", ()=> loadRecipes(true));

    loadRecipes(); // изначально все рецепты
</script>
</body>
</html>
